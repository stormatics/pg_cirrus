Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


💡 First run detected: please enter the following details:
Ansible vault password file: All checks for VAULT_PASSWORD_FILE were passed

Subnet address for the cluster: 
Primary PostgreSQL Server IP address: 
Standby 1 IP address: 
Standby 2 IP address: 
IP address of this node to setup pgpool: 

✅ Configuration saved to saved_config.json 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
fatal: [localhost]: FAILED! => {"changed": false, "cmd": "/usr/bin/apt-key add -", "msg": "Unable to add a key from binary data", "rc": 2, "stderr": "Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).\ngpg: error running '/usr/bin/gpg-agent': probably not installed\ngpg: failed to start gpg-agent '/usr/bin/gpg-agent': Configuration error\ngpg: can't connect to the gpg-agent: Configuration error\n", "stderr_lines": ["Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).", "gpg: error running '/usr/bin/gpg-agent': probably not installed", "gpg: failed to start gpg-agent '/usr/bin/gpg-agent': Configuration error", "gpg: can't connect to the gpg-agent: Configuration error"], "stdout": "", "stdout_lines": []}

PLAY RECAP *********************************************************************
localhost                  : ok=3    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   

Error: Failed to execute setup-pgdg-repo.yml playbook.
Enter PostgreSQL version (Latest: 16): Traceback (most recent call last):
  File "/home/postgres/pg_cirrus/3-node-cluster/deploy.py", line 384, in <module>
    main()
  File "/home/postgres/pg_cirrus/3-node-cluster/deploy.py", line 365, in main
    PG_VERSION = GET_POSTGRESQL_VERSION()
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/postgres/pg_cirrus/3-node-cluster/deploy.py", line 166, in GET_POSTGRESQL_VERSION
    USER_VERSION = input(f"Enter PostgreSQL version (Latest: { LATEST_VERSION }): ")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
changed: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=2    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
changed: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
changed: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
changed: [PRIMARY]

TASK [Creating data directory] *************************************************
changed: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
changed: [PRIMARY]

TASK [Creating password file] **************************************************
changed: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
ok: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
changed: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
changed: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=19   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create data directory] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Set permissions for data directory] **************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Start the standby server] ************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stopping pgpool2 service] ************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
changed: [STANDBY1]
changed: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=15   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=15   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [STANDBY1] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=logging_collector = on)
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=logging_collector = on)
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [STANDBY1]
changed: [PRIMARY]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Copy entire folder] ******************************************************
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create pgpool_node_id file based on role] ********************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=9    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=9    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=9    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
ok: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
ok: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=5    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=5    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
ok: [STANDBY1] => (item=listen_addresses = '*')
ok: [STANDBY2] => (item=listen_addresses = '*')
ok: [PRIMARY] => (item=listen_addresses = '*')
ok: [STANDBY1] => (item=port = 9999)
ok: [STANDBY2] => (item=port = 9999)
ok: [PRIMARY] => (item=port = 9999)
ok: [STANDBY1] => (item=log_statement = on)
ok: [PRIMARY] => (item=log_statement = on)
ok: [STANDBY2] => (item=log_statement = on)
ok: [STANDBY1] => (item=log_per_node_statement = on)
ok: [STANDBY2] => (item=log_per_node_statement = on)
ok: [PRIMARY] => (item=log_per_node_statement = on)
ok: [STANDBY1] => (item=sr_check_user = 'repuser')
ok: [STANDBY2] => (item=sr_check_user = 'repuser')
ok: [PRIMARY] => (item=sr_check_user = 'repuser')
ok: [STANDBY1] => (item=health_check_period = 10)
ok: [STANDBY2] => (item=health_check_period = 10)
ok: [PRIMARY] => (item=health_check_period = 10)
ok: [STANDBY1] => (item=health_check_user = 'repuser')
ok: [STANDBY2] => (item=health_check_user = 'repuser')
ok: [PRIMARY] => (item=health_check_user = 'repuser')
ok: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
ok: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
ok: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
ok: [STANDBY1] => (item=sr_check_password = '')
ok: [STANDBY2] => (item=sr_check_password = '')
ok: [PRIMARY] => (item=sr_check_password = '')
ok: [STANDBY1] => (item=health_check_password = '')
ok: [STANDBY2] => (item=health_check_password = '')
ok: [PRIMARY] => (item=health_check_password = '')
ok: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
ok: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
ok: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
ok: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
ok: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
ok: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
ok: [STANDBY1] => (item=backend_port0 = 5432)
ok: [STANDBY2] => (item=backend_port0 = 5432)
ok: [PRIMARY] => (item=backend_port0 = 5432)
ok: [STANDBY1] => (item=backend_port1 = 5432)
ok: [STANDBY2] => (item=backend_port1 = 5432)
ok: [PRIMARY] => (item=backend_port1 = 5432)
ok: [STANDBY1] => (item=backend_weight0 = 0)
ok: [STANDBY2] => (item=backend_weight0 = 0)
ok: [PRIMARY] => (item=backend_weight0 = 0)
ok: [STANDBY2] => (item=backend_weight1 = 0.5)
ok: [STANDBY1] => (item=backend_weight1 = 0.5)
ok: [PRIMARY] => (item=backend_weight1 = 0.5)
ok: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
ok: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
ok: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
ok: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
ok: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
ok: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
ok: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
ok: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
ok: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
ok: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
ok: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
ok: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
ok: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
ok: [STANDBY1] => (item=load_balance_mode = on)
ok: [STANDBY2] => (item=load_balance_mode = on)
ok: [PRIMARY] => (item=load_balance_mode = on)
ok: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
ok: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
ok: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
ok: [STANDBY1] => (item=statement_level_load_balance = on)
ok: [STANDBY2] => (item=statement_level_load_balance = on)
ok: [PRIMARY] => (item=statement_level_load_balance = on)
ok: [STANDBY1] => (item=pcp_listen_addresses = '*')
ok: [STANDBY2] => (item=pcp_listen_addresses = '*')
ok: [PRIMARY] => (item=pcp_listen_addresses = '*')
ok: [STANDBY1] => (item=pcp_port = 9898)
ok: [STANDBY2] => (item=pcp_port = 9898)
ok: [PRIMARY] => (item=pcp_port = 9898)
ok: [STANDBY1] => (item=log_destination = 'stderr,syslog')
ok: [PRIMARY] => (item=log_destination = 'stderr,syslog')
ok: [STANDBY2] => (item=log_destination = 'stderr,syslog')
ok: [STANDBY1] => (item=logging_collector = on)
ok: [PRIMARY] => (item=logging_collector = on)
ok: [STANDBY2] => (item=logging_collector = on)
ok: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
ok: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
ok: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
ok: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
ok: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
ok: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
ok: [STANDBY1] => (item=log_file_mode = 0600)
ok: [STANDBY2] => (item=log_file_mode = 0600)
ok: [PRIMARY] => (item=log_file_mode = 0600)
ok: [STANDBY1] => (item=use_watchdog = on)
ok: [STANDBY2] => (item=use_watchdog = on)
ok: [PRIMARY] => (item=use_watchdog = on)
ok: [STANDBY1] => (item=hostname0 = '192.168.100.252')
ok: [PRIMARY] => (item=hostname0 = '192.168.100.252')
ok: [STANDBY2] => (item=hostname0 = '192.168.100.252')
ok: [STANDBY1] => (item=wd_port0 = 9000)
ok: [PRIMARY] => (item=wd_port0 = 9000)
ok: [STANDBY2] => (item=wd_port0 = 9000)
ok: [STANDBY1] => (item=pgpool_port0 = 9999)
ok: [PRIMARY] => (item=pgpool_port0 = 9999)
ok: [STANDBY2] => (item=pgpool_port0 = 9999)
ok: [STANDBY1] => (item=hostname1 = '192.168.100.253')
ok: [PRIMARY] => (item=hostname1 = '192.168.100.253')
ok: [STANDBY2] => (item=hostname1 = '192.168.100.253')
ok: [STANDBY1] => (item=wd_port1 = 9000)
ok: [PRIMARY] => (item=wd_port1 = 9000)
ok: [STANDBY2] => (item=wd_port1 = 9000)
ok: [STANDBY1] => (item=pgpool_port1 = 9999)
ok: [PRIMARY] => (item=pgpool_port1 = 9999)
ok: [STANDBY2] => (item=pgpool_port1 = 9999)
ok: [STANDBY1] => (item=hostname2 = '192.168.100.254')
ok: [PRIMARY] => (item=hostname2 = '192.168.100.254')
ok: [STANDBY2] => (item=hostname2 = '192.168.100.254')
ok: [STANDBY1] => (item=wd_port2 = 9000)
ok: [PRIMARY] => (item=wd_port2 = 9000)
ok: [STANDBY2] => (item=wd_port2 = 9000)
ok: [STANDBY1] => (item=pgpool_port2 = 9999)
ok: [PRIMARY] => (item=pgpool_port2 = 9999)
ok: [STANDBY2] => (item=pgpool_port2 = 9999)
ok: [STANDBY1] => (item=wd_priority = 1)
ok: [PRIMARY] => (item=wd_priority = 1)
ok: [STANDBY2] => (item=wd_priority = 1)
ok: [STANDBY1] => (item=wd_authkey = 'secretkey')
ok: [PRIMARY] => (item=wd_authkey = 'secretkey')
ok: [STANDBY2] => (item=wd_authkey = 'secretkey')
ok: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
ok: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
ok: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
ok: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
ok: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
ok: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
ok: [STANDBY1] => (item=heartbeat_port0 = 9694)
ok: [PRIMARY] => (item=heartbeat_port0 = 9694)
ok: [STANDBY2] => (item=heartbeat_port0 = 9694)
ok: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
ok: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
ok: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
ok: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
ok: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
ok: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
ok: [PRIMARY] => (item=heartbeat_port1 = 9694)
ok: [STANDBY1] => (item=heartbeat_port1 = 9694)
ok: [STANDBY2] => (item=heartbeat_port1 = 9694)
ok: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
ok: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
ok: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
ok: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
ok: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
ok: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
ok: [PRIMARY] => (item=heartbeat_port2 = 9694)
ok: [STANDBY1] => (item=heartbeat_port2 = 9694)
ok: [STANDBY2] => (item=heartbeat_port2 = 9694)
ok: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
ok: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
ok: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
ok: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
ok: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
ok: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
ok: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
ok: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
ok: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
ok: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
ok: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
ok: [STANDBY1] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [PRIMARY]
changed: [STANDBY1]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Copy entire folder] ******************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Start pgpool2 service] ***************************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=14   changed=4    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
STANDBY1                   : ok=14   changed=4    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
STANDBY2                   : ok=14   changed=4    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Copy entire folder] ******************************************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=1    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=12   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=9    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=9    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=logging_collector = on)
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Copy entire folder] ******************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Start pgpool2 service] ***************************************************
changed: [STANDBY2]
changed: [PRIMARY]
changed: [STANDBY1]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [STANDBY1]
changed: [PRIMARY]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Copy entire folder] ******************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Start pgpool2 service] ***************************************************
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=logging_collector = on)
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [PRIMARY]
changed: [STANDBY1]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Copy entire folder] ******************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Stop already running service] ********************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [STANDBY1] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Copy entire folder] ******************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Start the standby server] ************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [PRIMARY]
changed: [STANDBY1]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [PRIMARY]
changed: [STANDBY1]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Copy entire folder] ******************************************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

TASK [Start pgpool2 service] ***************************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=1    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
changed: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=13   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=10   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=10   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=enable_consensus_with_half_votes = off)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=enable_consensus_with_half_votes = off)
changed: [PRIMARY] => (item=enable_consensus_with_half_votes = off)

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [STANDBY2]
changed: [STANDBY1]
changed: [PRIMARY]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Copy entire folder] ******************************************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Start the standby server] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [STANDBY1] => (item=port = 9999)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [PRIMARY] => (item=enable_consensus_with_half_votes = off)
changed: [STANDBY2] => (item=enable_consensus_with_half_votes = off)
changed: [STANDBY1] => (item=enable_consensus_with_half_votes = off)

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Copy entire folder] ******************************************************
changed: [STANDBY1]
changed: [PRIMARY]
changed: [STANDBY2]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [PRIMARY]
ok: [STANDBY2]
ok: [STANDBY1]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=7    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=7    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=7    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "192.168.100.252",
    "standby_ips": [
        "192.168.100.253",
        "192.168.100.254"
    ],
    "pgpool_ip": "192.168.100.251"
} 

[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [localhost]

TASK [Download the PGDG RPM package] *******************************************
skipping: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
skipping: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
changed: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
changed: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
changed: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=26   changed=11   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Download the PGDG RPM package] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Create data directory] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Set permissions for data directory] **************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Stop already running service] ********************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Creating .pgpass file] ***************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'})
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_192_168_100_253'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_192_168_100_254'}) 

TASK [Start the standby server] ************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool2] *********************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stopping pgpool2 service] ************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Creating pcppass file] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
STANDBY2                   : ok=21   changed=8    unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Create pgpool_logs directory in /var/log/] *******************************
ok: [STANDBY2]
ok: [STANDBY1]
ok: [PRIMARY]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************
changed: [STANDBY1] => (item=listen_addresses = '*')
changed: [STANDBY2] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [STANDBY1] => (item=port = 9999)
changed: [STANDBY2] => (item=port = 9999)
changed: [PRIMARY] => (item=port = 9999)
changed: [STANDBY1] => (item=log_statement = on)
changed: [STANDBY2] => (item=log_statement = on)
changed: [PRIMARY] => (item=log_statement = on)
changed: [STANDBY1] => (item=log_per_node_statement = on)
changed: [STANDBY2] => (item=log_per_node_statement = on)
changed: [PRIMARY] => (item=log_per_node_statement = on)
changed: [STANDBY1] => (item=sr_check_user = 'repuser')
changed: [STANDBY2] => (item=sr_check_user = 'repuser')
changed: [PRIMARY] => (item=sr_check_user = 'repuser')
changed: [STANDBY1] => (item=health_check_period = 10)
changed: [STANDBY2] => (item=health_check_period = 10)
changed: [PRIMARY] => (item=health_check_period = 10)
changed: [STANDBY1] => (item=health_check_user = 'repuser')
changed: [STANDBY2] => (item=health_check_user = 'repuser')
changed: [PRIMARY] => (item=health_check_user = 'repuser')
changed: [STANDBY1] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY2] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [PRIMARY] => (item=pool_passwd = '/etc/pgpool2/pool_passwd')
changed: [STANDBY1] => (item=sr_check_password = '')
changed: [STANDBY2] => (item=sr_check_password = '')
changed: [PRIMARY] => (item=sr_check_password = '')
changed: [STANDBY1] => (item=health_check_password = '')
changed: [STANDBY2] => (item=health_check_password = '')
changed: [PRIMARY] => (item=health_check_password = '')
changed: [STANDBY1] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=backend_hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=backend_hostname0 = '192.168.100.252')
changed: [STANDBY1] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=backend_hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=backend_hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=backend_port0 = 5432)
changed: [STANDBY2] => (item=backend_port0 = 5432)
changed: [PRIMARY] => (item=backend_port0 = 5432)
changed: [STANDBY1] => (item=backend_port1 = 5432)
changed: [STANDBY2] => (item=backend_port1 = 5432)
changed: [PRIMARY] => (item=backend_port1 = 5432)
changed: [STANDBY1] => (item=backend_weight0 = 0)
changed: [STANDBY2] => (item=backend_weight0 = 0)
changed: [PRIMARY] => (item=backend_weight0 = 0)
changed: [STANDBY1] => (item=backend_weight1 = 0.5)
changed: [STANDBY2] => (item=backend_weight1 = 0.5)
changed: [PRIMARY] => (item=backend_weight1 = 0.5)
changed: [STANDBY1] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory0 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY2] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [PRIMARY] => (item=backend_data_directory1 = '/home/postgres/stormatics/pg_cirrus/data')
changed: [STANDBY1] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag0 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [PRIMARY] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY2] => (item=backend_flag1 = 'ALLOW_TO_FAILOVER')
changed: [STANDBY1] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [PRIMARY] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY2] => (item=failover_command ='/home/postgres/stormatics/pg_cirrus/failover.sh %d %h %p %D %m %H %M %P %r %R %N %S 17 5432')
changed: [STANDBY1] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [PRIMARY] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY2] => (item=follow_primary_command = '/home/postgres/stormatics/pg_cirrus/follow_primary.sh %d %h %p %D %m %H %M %P %r %R %N %S 5432 192.168.100.251')
changed: [STANDBY1] => (item=load_balance_mode = on)
changed: [PRIMARY] => (item=load_balance_mode = on)
changed: [STANDBY2] => (item=load_balance_mode = on)
changed: [STANDBY1] => (item=database_redirect_preference_list = '.*:standby')
changed: [PRIMARY] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY2] => (item=database_redirect_preference_list = '.*:standby')
changed: [STANDBY1] => (item=statement_level_load_balance = on)
changed: [PRIMARY] => (item=statement_level_load_balance = on)
changed: [STANDBY2] => (item=statement_level_load_balance = on)
changed: [STANDBY1] => (item=pcp_listen_addresses = '*')
changed: [PRIMARY] => (item=pcp_listen_addresses = '*')
changed: [STANDBY2] => (item=pcp_listen_addresses = '*')
changed: [STANDBY1] => (item=pcp_port = 9898)
changed: [PRIMARY] => (item=pcp_port = 9898)
changed: [STANDBY2] => (item=pcp_port = 9898)
changed: [STANDBY1] => (item=log_destination = 'stderr,syslog')
changed: [PRIMARY] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY2] => (item=log_destination = 'stderr,syslog')
changed: [STANDBY1] => (item=logging_collector = on)
changed: [PRIMARY] => (item=logging_collector = on)
changed: [STANDBY2] => (item=logging_collector = on)
changed: [STANDBY1] => (item=log_directory = '/var/log/pgpool_logs')
changed: [PRIMARY] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY2] => (item=log_directory = '/var/log/pgpool_logs')
changed: [STANDBY1] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [PRIMARY] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY2] => (item=log_filename = 'pgpool-%Y-%m-%d_%H%M%S.log')
changed: [STANDBY1] => (item=log_file_mode = 0600)
changed: [PRIMARY] => (item=log_file_mode = 0600)
changed: [STANDBY2] => (item=log_file_mode = 0600)
changed: [STANDBY1] => (item=use_watchdog = on)
changed: [PRIMARY] => (item=use_watchdog = on)
changed: [STANDBY2] => (item=use_watchdog = on)
changed: [STANDBY1] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=hostname0 = '192.168.100.252')
changed: [STANDBY2] => (item=hostname0 = '192.168.100.252')
changed: [PRIMARY] => (item=wd_port0 = 9000)
changed: [STANDBY1] => (item=wd_port0 = 9000)
changed: [STANDBY2] => (item=wd_port0 = 9000)
changed: [PRIMARY] => (item=pgpool_port0 = 9999)
changed: [STANDBY1] => (item=pgpool_port0 = 9999)
changed: [STANDBY2] => (item=pgpool_port0 = 9999)
changed: [PRIMARY] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY1] => (item=hostname1 = '192.168.100.253')
changed: [STANDBY2] => (item=hostname1 = '192.168.100.253')
changed: [PRIMARY] => (item=wd_port1 = 9000)
changed: [STANDBY1] => (item=wd_port1 = 9000)
changed: [STANDBY2] => (item=wd_port1 = 9000)
changed: [PRIMARY] => (item=pgpool_port1 = 9999)
changed: [STANDBY1] => (item=pgpool_port1 = 9999)
changed: [STANDBY2] => (item=pgpool_port1 = 9999)
changed: [PRIMARY] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY1] => (item=hostname2 = '192.168.100.254')
changed: [STANDBY2] => (item=hostname2 = '192.168.100.254')
changed: [PRIMARY] => (item=wd_port2 = 9000)
changed: [STANDBY1] => (item=wd_port2 = 9000)
changed: [STANDBY2] => (item=wd_port2 = 9000)
changed: [PRIMARY] => (item=pgpool_port2 = 9999)
changed: [STANDBY1] => (item=pgpool_port2 = 9999)
changed: [STANDBY2] => (item=pgpool_port2 = 9999)
changed: [PRIMARY] => (item=wd_priority = 1)
changed: [STANDBY1] => (item=wd_priority = 1)
changed: [STANDBY2] => (item=wd_priority = 1)
changed: [PRIMARY] => (item=wd_authkey = 'secretkey')
changed: [STANDBY1] => (item=wd_authkey = 'secretkey')
changed: [STANDBY2] => (item=wd_authkey = 'secretkey')
changed: [PRIMARY] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY1] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [STANDBY2] => (item=wd_monitoring_interfaces_list = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY1] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [STANDBY2] => (item=heartbeat_hostname0 = '192.168.100.253')
changed: [PRIMARY] => (item=heartbeat_port0 = 9694)
changed: [STANDBY1] => (item=heartbeat_port0 = 9694)
changed: [STANDBY2] => (item=heartbeat_port0 = 9694)
changed: [PRIMARY] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device0 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device0 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY1] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [STANDBY2] => (item=heartbeat_hostname1 = '192.168.100.254')
changed: [PRIMARY] => (item=heartbeat_port1 = 9694)
changed: [STANDBY1] => (item=heartbeat_port1 = 9694)
changed: [STANDBY2] => (item=heartbeat_port1 = 9694)
changed: [PRIMARY] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device1 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device1 = 'eth0')
changed: [PRIMARY] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY1] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [STANDBY2] => (item=heartbeat_hostname2 = '192.168.100.252')
changed: [PRIMARY] => (item=heartbeat_port2 = 9694)
changed: [STANDBY1] => (item=heartbeat_port2 = 9694)
changed: [STANDBY2] => (item=heartbeat_port2 = 9694)
changed: [PRIMARY] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY1] => (item=heartbeat_device2 = 'eth0')
changed: [STANDBY2] => (item=heartbeat_device2 = 'eth0')
changed: [PRIMARY] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY1] => (item=wd_heartbeat_keepalive = 2)
changed: [STANDBY2] => (item=wd_heartbeat_keepalive = 2)
changed: [PRIMARY] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY2] => (item=wd_heartbeat_deadtime = 10)
changed: [STANDBY1] => (item=delegate_IP = '192.168.100.250')
changed: [PRIMARY] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY2] => (item=delegate_IP = '192.168.100.250')
changed: [STANDBY1] => (item=enable_consensus_with_half_votes = off)
changed: [STANDBY2] => (item=enable_consensus_with_half_votes = off)
changed: [PRIMARY] => (item=enable_consensus_with_half_votes = off)

TASK [Search for existing standby2 in pgpool.conf] *****************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Add configurations for standby2 to pgpool.conf if not already present] ***
changed: [STANDBY1]
changed: [STANDBY2]
changed: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create a pool_passwd file] ***********************************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Ensure PostgreSQL socket directory exists] *******************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Stopping the already running pgpool2 service] ****************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Copy entire folder] ******************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Start pgpool2 service] ***************************************************
changed: [PRIMARY]
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Create pgpool_node_id file based on role] ********************************
ok: [STANDBY1]
ok: [PRIMARY]
ok: [STANDBY2]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY1                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
STANDBY2                   : ok=15   changed=6    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

