Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


💡 First run detected: please enter the following details:
Ansible vault password file: All checks for VAULT_PASSWORD_FILE were passed

Subnet address for the cluster: 
Primary PostgreSQL Server IP address: 
Standby 1 IP address: 
Standby 2 IP address: 
IP address of this node to setup pgpool: 
Enter Delegate IP for Pgpool VIP: 

✅ Configuration saved to saved_config.json 

[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [localhost]

TASK [Download the PGDG RPM package] *******************************************
changed: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
changed: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
fatal: [localhost]: FAILED! => {"changed": true, "cmd": ["yum", "makecache"], "delta": "0:00:17.119249", "end": "2025-08-08 09:37:53.388461", "msg": "non-zero return code", "rc": 1, "start": "2025-08-08 09:37:36.269212", "stderr": "Importing GPG key 0x08B40D20:\n Userid     : \"PostgreSQL RPM Repository <pgsql-pkg-yum@lists.postgresql.org>\"\n Fingerprint: D4BF 08AE 67A0 B4C7 A1DB CCD2 40BC A2B4 08B4 0D20\n From       : /etc/pki/rpm-gpg/PGDG-RPM-GPG-KEY-RHEL\nError: Failed to download metadata for repo 'pgdg-common': repomd.xml GPG signature verification error: Bad GPG signature", "stderr_lines": ["Importing GPG key 0x08B40D20:", " Userid     : \"PostgreSQL RPM Repository <pgsql-pkg-yum@lists.postgresql.org>\"", " Fingerprint: D4BF 08AE 67A0 B4C7 A1DB CCD2 40BC A2B4 08B4 0D20", " From       : /etc/pki/rpm-gpg/PGDG-RPM-GPG-KEY-RHEL", "Error: Failed to download metadata for repo 'pgdg-common': repomd.xml GPG signature verification error: Bad GPG signature"], "stdout": "AlmaLinux 9 - AppStream                          57 MB/s |  15 MB     00:00    \nAlmaLinux 9 - BaseOS                             62 MB/s |  18 MB     00:00    \nAlmaLinux 9 - Extras                            261 kB/s |  20 kB     00:00    \nExtra Packages for Enterprise Linux 9 - x86_64   43 MB/s |  20 MB     00:00    \nExtra Packages for Enterprise Linux 9 openh264  5.1 kB/s | 2.5 kB     00:00    \nPostgreSQL common RPMs for RHEL / Rocky / AlmaL 7.2 kB/s | 659  B     00:00    \nPostgreSQL common RPMs for RHEL / Rocky / AlmaL 2.4 MB/s | 2.4 kB     00:00    \nIs this ok [y/N]: PostgreSQL common RPMs for RHEL / Rocky / AlmaL  12 kB/s | 659  B     00:00    ", "stdout_lines": ["AlmaLinux 9 - AppStream                          57 MB/s |  15 MB     00:00    ", "AlmaLinux 9 - BaseOS                             62 MB/s |  18 MB     00:00    ", "AlmaLinux 9 - Extras                            261 kB/s |  20 kB     00:00    ", "Extra Packages for Enterprise Linux 9 - x86_64   43 MB/s |  20 MB     00:00    ", "Extra Packages for Enterprise Linux 9 openh264  5.1 kB/s | 2.5 kB     00:00    ", "PostgreSQL common RPMs for RHEL / Rocky / AlmaL 7.2 kB/s | 659  B     00:00    ", "PostgreSQL common RPMs for RHEL / Rocky / AlmaL 2.4 MB/s | 2.4 kB     00:00    ", "Is this ok [y/N]: PostgreSQL common RPMs for RHEL / Rocky / AlmaL  12 kB/s | 659  B     00:00    "]}

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=3    unreachable=0    failed=1    skipped=3    rescued=0    ignored=0   

Error: Failed to execute setup-pgdg-repo.yml playbook.
Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
changed: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
changed: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************

pg_cirrus terminated by the user.
Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "10.10.10.121",
    "standby_ips": [
        "10.10.10.122",
        "10.10.10.123"
    ],
    "pgpool_ip": "10.10.10.120",
    "delegate_ip": "10.10.10.124"
} 

[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [localhost]

TASK [Download the PGDG RPM package] *******************************************
ok: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
ok: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
changed: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=6    changed=2    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
ok: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
ok: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
changed: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
changed: [PRIMARY]

TASK [Creating data directory] *************************************************
changed: [PRIMARY]

TASK [Stop already running service] ********************************************
skipping: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
changed: [PRIMARY]

TASK [Creating password file] **************************************************
changed: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_10_10_10_122'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_10_10_10_123'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
skipping: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
changed: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
changed: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
ok: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
changed: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
changed: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=27   changed=17   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Download the PGDG RPM package] *******************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************

pg_cirrus terminated by the user.
Welcome to pg_cirrus - Hassle-free PostgreSQL Cluster Setup


🔁 Loaded configuration from saved_config.json
{
    "vault_password_file": "vault",
    "cluster_subnet": "0.0.0.0/0",
    "primary_ip": "10.10.10.121",
    "standby_ips": [
        "10.10.10.122",
        "10.10.10.123"
    ],
    "pgpool_ip": "10.10.10.120",
    "delegate_ip": "10.10.10.124"
} 

[WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [localhost]

TASK [Install PostgreSQL] ******************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for localhost

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [localhost]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [localhost]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [localhost]

TASK [Download the PGDG RPM package] *******************************************
ok: [localhost]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
ok: [localhost]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [localhost]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
changed: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=6    changed=2    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   

Enter PostgreSQL version (Latest: 17): Enter the PostgreSQL port number: (Default: 5432): Enter the Data Directory Path: (Default: /home/postgres/stormatics/pg_cirrus/data): Generating conf.yml ...
Generating inventory file ...

PLAY [Configure PostgreSQL primary server] *************************************

TASK [Gathering Facts] *********************************************************
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for PRIMARY

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [PRIMARY]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [PRIMARY]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [PRIMARY]

TASK [Download the PGDG RPM package] *******************************************
ok: [PRIMARY]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
ok: [PRIMARY]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [PRIMARY]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
changed: [PRIMARY]

TASK [Install PostgreSQL-17] ***************************************************
ok: [PRIMARY]

TASK [Creating data directory] *************************************************
ok: [PRIMARY]

TASK [Stop already running service] ********************************************
skipping: [PRIMARY]

TASK [Installing python3-psycopg2] *********************************************
ok: [PRIMARY]

TASK [Creating password file] **************************************************
ok: [PRIMARY]

TASK [Check if the data directory is empty] ************************************
ok: [PRIMARY]

TASK [Display message and exit if the data directory is not empty] *************
skipping: [PRIMARY]

TASK [Initialize the data directory for the Primary PostgreSQL server] *********
changed: [PRIMARY]

TASK [Append PostgreSQL Configuration] *****************************************
changed: [PRIMARY] => (item=listen_addresses = '*')
changed: [PRIMARY] => (item=wal_level = replica)
changed: [PRIMARY] => (item=max_wal_senders = 10)
changed: [PRIMARY] => (item=wal_keep_size = 1GB)

TASK [Start the server] ********************************************************
changed: [PRIMARY]

TASK [Creating a replication slots] ********************************************
[WARNING]: Database name has not been passed, used default database to connect
to.
ok: [PRIMARY] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_10_10_10_122'})
ok: [PRIMARY] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_10_10_10_123'})

TASK [Creating a replication user] *********************************************
changed: [PRIMARY]

TASK [Update pg_hba.conf] ******************************************************
changed: [PRIMARY]

TASK [Restart the server] ******************************************************
changed: [PRIMARY]

TASK [Install pgpool2] *********************************************************
skipping: [PRIMARY]

TASK [Install pgpool-II release RPM] *******************************************
ok: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
ok: [PRIMARY]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [PRIMARY]

TASK [Add user and password to pcp.conf] ***************************************
changed: [PRIMARY]

TASK [Stopping pgpool2 service] ************************************************
ok: [PRIMARY]

TASK [Creating pcppass file] ***************************************************
ok: [PRIMARY]

TASK [Creating .pgpass file] ***************************************************
ok: [PRIMARY]

PLAY RECAP *********************************************************************
PRIMARY                    : ok=27   changed=9    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   


PLAY [Setup Standby servers] ***************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Load common variables] ***************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Setup pgdg repo] *********************************************************
included: /home/postgres/pg_cirrus/3-node-cluster/ansible/tasks/setup-pgdg-repo.yml for STANDBY1, STANDBY2

TASK [Add pgdg repo to sources (Debian/Ubuntu)] ********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Download PostgreSQL key (Debian/Ubuntu)] *********************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Update apt cache (Debian/Ubuntu)] ****************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Download the PGDG RPM package] *******************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Add pgdg repo to YUM (Red Hat/CentOS/Fedora)] ****************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Clean YUM cache (Red Hat/CentOS/Fedora)] *********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update YUM cache (Red Hat/CentOS/Fedora)] ********************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install PostgreSQL-17] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Create data directory] ***************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Set permissions for data directory] **************************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Stop already running service] ********************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Creating .pgpass file] ***************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Check if the data directory is empty] ************************************
ok: [STANDBY2]
ok: [STANDBY1]

TASK [Display error message and exit if the directory is not empty] ************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Run pg_basebackup for standby servers] ***********************************
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Update primary_slot_name in postgresql.conf] *****************************
skipping: [STANDBY2] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_10_10_10_122'}) 
changed: [STANDBY1] => (item={'NAME': 'STANDBY1', 'PG_REPLICATION_SLOT': 'slot_10_10_10_122'})
skipping: [STANDBY1] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_10_10_10_123'}) 
changed: [STANDBY2] => (item={'NAME': 'STANDBY2', 'PG_REPLICATION_SLOT': 'slot_10_10_10_123'})

TASK [Start the standby server] ************************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool2] *********************************************************
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Change permissions, owner, and group of the pcp.conf file] ***************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Add user and password to pcp.conf] ***************************************
changed: [STANDBY1]
changed: [STANDBY2]

TASK [Stopping pgpool2 service] ************************************************
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Creating pcppass file] ***************************************************
changed: [STANDBY2]
changed: [STANDBY1]

PLAY RECAP *********************************************************************
STANDBY1                   : ok=22   changed=13   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
STANDBY2                   : ok=22   changed=13   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   


PLAY [Configure pgpool2] *******************************************************

TASK [Gathering Facts] *********************************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Load common variables] ***************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Load vault variables] ****************************************************
ok: [PRIMARY]
ok: [STANDBY1]
ok: [STANDBY2]

TASK [Install pgpool2] *********************************************************
skipping: [PRIMARY]
skipping: [STANDBY1]
skipping: [STANDBY2]

TASK [Install pgpool-II release RPM] *******************************************
ok: [STANDBY1]
ok: [STANDBY2]
ok: [PRIMARY]

TASK [Install pgpool-II for the specified PostgreSQL version on RHEL] **********
ok: [STANDBY2]
ok: [PRIMARY]
ok: [STANDBY1]

TASK [Create pgpool_logs directory in /var/log/] *******************************
changed: [PRIMARY]
changed: [STANDBY2]
changed: [STANDBY1]

TASK [Ensure pgpool.conf settings are present and not duplicated] **************

pg_cirrus terminated by the user.
